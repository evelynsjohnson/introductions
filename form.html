<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Submit Your Profile | LocEssentials Introductions</title>
  <meta name="description" content="Share your profile to join the LocEssentials community.">
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="assets/css/styles.css">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
</head>
<body>
  <header>
    <div class="container">
      <div class="header-content">
        <a href="index.html">
          <img src="assets/images/LocCapTransparentTilted.png" alt="LocEssentials Logo" class="logo">
        </a>
        <nav>
          <ul>
            <li><a href="index.html" data-lang-key="nav-home">Meet Our Team</a></li>
            <li><a href="form.html" data-lang-key="nav-form">Submit Your Profile</a></li>
            <li><a href="game.html" data-lang-key="nav-game">Play Guess Who</a></li>
            <li><a href="answer-key.html" data-lang-key="nav-answer">Answer Key</a></li>
          </ul>
        </nav>
        <div class="language-toggle">
          <button class="lang-btn active" onclick="switchLanguage('en')">English</button>
          <button class="lang-btn" onclick="switchLanguage('es')">Español</button>
        </div>
      </div>
    </div>
  </header>

  <main>
    <div class="container">
      <h1 class="text-center" data-lang-key="form-title">Submit Your Profile</h1>
      <p class="text-center" style="max-width: 800px; margin: 0 auto var(--spacing-xl);" data-lang-key="form-description">
        Share your real-life profile and create an alter ego to join our community! Your information will be used for our "Guess Who" game and team directory.
      </p>

      <!-- Profile Selection View (shown when no form is active) -->
      <div id="profile-selection-view">
        <!-- Profile Summary Cards -->
        <div id="profile-cards-container" class="profile-cards">
          <!-- Profile cards will be dynamically added here -->
        </div>

        <!-- Add Profile Buttons -->
        <div id="add-profile-buttons" class="add-profile-section">
          <button type="button" class="btn btn-primary btn-add-profile" id="add-english-profile" data-lang="en">
            <span data-lang-key="add-english-profile">Add an English Profile</span>
          </button>
          <button type="button" class="btn btn-primary btn-add-profile" id="add-spanish-profile" data-lang="es">
            <span data-lang-key="add-spanish-profile">Add a Spanish Profile</span>
          </button>
        </div>

        <!-- Submit My Profile Button (initially disabled) -->
        <div class="text-center" style="margin-top: var(--spacing-xl);">
          <button type="button" class="btn btn-primary btn-large" id="submit-all-profiles" disabled>
            <span data-lang-key="submit-my-profile">Submit My Profile</span>
          </button>
        </div>
      </div>

      <!-- Success Confirmation View (hidden initially) -->
      <div id="success-view" style="display: none;">
        <div class="success-message">
          <div class="success-icon">✓</div>
          <h2 data-lang-key="success-title">Profile Submitted Successfully!</h2>
          <p data-lang-key="success-message">Your profile has been saved and submitted.</p>
          <div class="success-actions">
            <button type="button" class="btn btn-primary" id="home-button">
              <span data-lang-key="btn-home">Home</span>
            </button>
            <button type="button" class="btn btn-secondary" id="submit-new-profile-button">
              <span data-lang-key="btn-submit-new">Submit a New Profile</span>
            </button>
          </div>
        </div>
      </div>

      <!-- Form Container (hidden initially) -->
      <div id="form-container" style="display: none;">
        <!-- Back/Cancel Button -->
        <div class="form-header">
          <button type="button" class="btn btn-secondary btn-back" id="back-button">
            <span data-lang-key="back-button">← Back / Cancel</span>
          </button>
        </div>

        <form id="profile-form" class="profile-form">
        
        <!-- Me in Real Life Section -->
        <section class="form-section collapsible">
          <h2 class="section-header">
            <span class="collapse-icon">▼</span>
            <span data-i18n="section-real-life">Me in Real Life</span>
          </h2>
          <div class="section-content">

          <div class="form-group">
            <label for="full-name" data-i18n="label-full-name">Full Name</label>
            <input type="text" id="full-name" name="full_name" required>
          </div>

          <div class="form-group">
            <label for="preferred-name" data-i18n="label-preferred-name">Preferred Name</label>
            <input type="text" id="preferred-name" name="preferred_name" required>
          </div>

          <div class="form-group">
            <label for="photo" data-i18n="label-photo">A Picture of Me</label>
            <input type="file" id="photo" name="photo" accept="image/*" required>
          </div>

          <div class="form-group">
            <label for="photo-alt" data-i18n="label-photo-alt">Alt Text for Your Image</label>
            <input type="text" id="photo-alt" name="photo_alt" required>
            <p class="form-note" data-i18n-note="note-photo-alt">Write a brief description for accessibility</p>
          </div>

          <div class="form-group">
            <label for="pronunciation" data-i18n="label-pronunciation">How to Pronounce My Name (MP3 audio file)</label>
            <input type="file" id="pronunciation" name="pronunciation_file" accept="audio/mp3">
            <p class="form-note" data-i18n-note="note-pronunciation">Record yourself saying your name using Audacity and save as MP3</p>
          </div>

          <div class="form-group">
            <label for="pronouns" data-i18n="label-pronouns">My Preferred Pronouns</label>
            <input type="text" id="pronouns" name="pronouns">
          </div>

          <div class="form-group">
            <label for="languages" data-i18n="label-languages">The Languages I Speak</label>
            <input type="text" id="languages" name="languages" required>
          </div>

          <div class="form-group">
            <label for="social-media" data-i18n="label-social-media">Connect With Me (Social Media Links)</label>
            <textarea id="social-media" name="social_media" data-i18n-placeholder="placeholder-social-media" placeholder="LinkedIn: https://linkedin.com/in/yourprofile&#10;Instagram: @yourusername"></textarea>
          </div>

          <div class="form-group">
            <label for="about" data-i18n="label-about">About Me</label>
            <textarea id="about" name="about" required></textarea>
          </div>

          <div class="form-group">
            <label for="prev-exp" data-i18n="label-prev-exp">My Previous Experience in Translation and Localization</label>
            <textarea id="prev-exp" name="previous_experience"></textarea>
          </div>

          <h3 class="subsection-header">
            <span data-i18n="section-course">Course Information</span>
          </h3>

          <div class="form-group">
            <label for="course" data-i18n="label-course">The Course I'm Enrolled In</label>
            <select id="course" name="course" required>
              <option value="" data-i18n="option-select-course">-- Select a course --</option>
              <option value="Loc101">Loc101: Introduction to Localization</option>
              <option value="Loc501">Loc501: Terminology for Beginners</option>
            </select>
          </div>

          <div class="form-group">
            <label for="section" data-i18n="label-section">The rendition of the course I'm enrolled in</label>
            <input type="text" id="section" name="section" data-i18n-placeholder="placeholder-section" placeholder="e.g., 2024-1" required>
          </div>

          <div class="form-group">
            <label for="enrollment" data-i18n="label-enrollment">I Enrolled in This Course Because...</label>
            <textarea id="enrollment" name="enrollment_reason"></textarea>
          </div>

          <div class="form-group">
            <label for="goals" data-i18n="label-goals">What I Want to Learn in This Course Is...</label>
            <textarea id="goals" name="goals"></textarea>
          </div>

          </div>
        </section>

        <!-- My Alter Ego Section -->
        <section class="form-section collapsible">
          <h2 class="section-header">
            <span class="collapse-icon">▼</span>
            <span data-i18n="section-alter-ego">My Alter Ego</span>
          </h2>
          <div class="section-content">
          <p class="form-description" data-i18n="description-alter-ego">
            Think of your alter ego as a stage character or hidden identity. You could be a superhero, a super villain, or anyone in between!
          </p>
          
          <div class="form-group">
            <label for="alter-name" data-i18n="label-alter-name">My Alter Ego's Name</label>
            <input type="text" id="alter-name" name="alter_ego_name" required>
          </div>

          <div class="form-group">
            <label for="alter-photo" data-i18n="label-alter-photo">A Picture of My Alter Ego</label>
            <input type="file" id="alter-photo" name="alter_ego_photo" accept="image/*" required>
          </div>

          <div class="form-group">
            <label for="alter-credits" data-i18n="label-alter-credits">Picture Credits</label>
            <input type="text" id="alter-credits" name="alter_ego_credits" required>
            <p class="form-note" data-i18n-note="note-alter-credits">Provide information about where you got this image</p>
          </div>

          <div class="form-group">
            <label for="alter-alt" data-i18n="label-alter-alt">Alt Text for Your Alter Ego Picture</label>
            <input type="text" id="alter-alt" name="alter_ego_alt" required>
          </div>

          <div class="form-group">
            <label for="alter-job" data-i18n="label-alter-job">Job Title</label>
            <input type="text" id="alter-job" name="alter_ego_job" required>
          </div>

          <div class="form-group">
            <label for="alter-org" data-i18n="label-alter-org">Organization</label>
            <input type="text" id="alter-org" name="alter_ego_org">
          </div>

          <div class="form-group">
            <label for="alter-about" data-i18n="label-alter-about">About My Alter Ego</label>
            <textarea id="alter-about" name="alter_ego_about" required></textarea>
          </div>

          <div class="form-group">
            <label for="subject-fields" data-i18n="label-subject-fields">The Subject Fields That Interest Me</label>
            <input type="text" id="subject-fields" name="subject_fields">
          </div>

          <div class="form-group">
            <label for="hobbies" data-i18n="label-hobbies">Interests and Hobbies Outside of Work</label>
            <textarea id="hobbies" name="hobbies"></textarea>
          </div>

          </div>
        </section>

        <!-- Privacy Agreement Section (at bottom of form before submit) -->
        <section class="form-section privacy-agreement">
          <div class="form-group">
            <div class="checkbox-group">
              <input type="checkbox" id="final-privacy-consent" name="final_privacy_consent" required>
              <label for="final-privacy-consent" data-i18n="privacy-agreement">
                I consent to having my profile displayed publicly on the LocEssentials website after course completion. During the course, all students will see each other regardless of this setting.
              </label>
            </div>
          </div>
        </section>

        <!-- Submit Button -->
        <div class="text-center">
          <button type="submit" class="btn btn-primary btn-large" id="add-profile-submit">
            <span data-i18n="btn-add-profile-submit">Add Profile</span>
          </button>
        </div>
      </form>
      </div>
    </div>
  </main>

  <footer style="text-align: center; padding: var(--spacing-xl) 0; color: #999;">
    <p>&copy; 2025 LocEssentials. All rights reserved.</p>
  </footer>

  <script src="assets/js/page-translations.js"></script>
  <script src="assets/js/form-translations.js"></script>
  <script>
    // Profile management state
    let profiles = {
      en: null,
      es: null
    };
    let currentFormLanguage = null;
    let editingLanguage = null;
    let currentLang = localStorage.getItem('preferredLanguage') || 'en';

    // Load saved profiles from localStorage
    function loadProfiles() {
      const saved = localStorage.getItem('studentProfiles');
      if (saved) {
        profiles = JSON.parse(saved);
      }
    }

    // Save profiles to localStorage
    function saveProfiles() {
      localStorage.setItem('studentProfiles', JSON.stringify(profiles));
    }

    // Switch page language
    function switchLanguage(lang) {
      currentLang = lang;
      localStorage.setItem('preferredLanguage', lang);
      
      // Update button states
      document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      
      // Find and activate the correct button
      document.querySelectorAll('.lang-btn').forEach(btn => {
        if ((lang === 'en' && btn.textContent.includes('English')) || 
            (lang === 'es' && btn.textContent.includes('Español'))) {
          btn.classList.add('active');
        }
      });
      
      updateLanguage(lang);
      updateProfileSelectionView();
      updateSuccessViewLanguage();
    }

    // Update all translatable elements
    function updateLanguage(lang) {
      const trans = {...(pageTranslations[lang] || {}), ...(formTranslations[lang] || {})};
      if (!trans) return;
      
      // Update elements with data-lang-key attribute
      document.querySelectorAll('[data-lang-key]').forEach(element => {
        const key = element.getAttribute('data-lang-key');
        if (trans[key]) {
          if (element.tagName === 'INPUT' && element.type === 'button') {
            element.value = trans[key];
          } else if (element.tagName === 'BUTTON' || element.tagName === 'SPAN') {
            element.textContent = trans[key];
          } else if (element.classList.contains('section-header')) {
            const icon = element.querySelector('.collapse-icon');
            if (icon) {
              element.innerHTML = '';
              element.appendChild(icon);
              element.appendChild(document.createTextNode(' ' + trans[key]));
            } else {
              element.textContent = trans[key];
            }
          } else {
            element.textContent = trans[key];
          }
        }
      });
      
      // Update form labels with data-i18n attribute (for form fields)
      document.querySelectorAll('[data-i18n]').forEach(element => {
        const key = element.getAttribute('data-i18n');
        if (trans[key]) {
          const text = trans[key];
          // Check if field is required and add asterisk
          const isRequired = element.closest('.form-group')?.querySelector('[required]');
          element.textContent = isRequired ? `${text} *` : text;
        }
      });
      
      // Update placeholders
      document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
        const key = element.getAttribute('data-i18n-placeholder');
        if (trans[key]) {
          element.placeholder = trans[key];
        }
      });
      
      // Update form notes
      document.querySelectorAll('[data-i18n-note]').forEach(element => {
        const key = element.getAttribute('data-i18n-note');
        if (trans[key]) {
          element.textContent = trans[key];
        }
      });

      document.documentElement.lang = lang;
    }

    // Show profile selection view
    function showProfileSelection() {
      document.getElementById('profile-selection-view').style.display = 'block';
      document.getElementById('form-container').style.display = 'none';
      currentFormLanguage = null;
      editingLanguage = null;
      updateProfileSelectionView();
    }

    // Update profile selection view
    function updateProfileSelectionView() {
      const container = document.getElementById('profile-cards-container');
      const addButtons = document.getElementById('add-profile-buttons');
      const submitButton = document.getElementById('submit-all-profiles');
      
      // Clear existing cards
      container.innerHTML = '';
      
      // Add profile cards for filled profiles first
      if (profiles.en) {
        container.appendChild(createProfileCard('en', profiles.en));
      }
      if (profiles.es) {
        container.appendChild(createProfileCard('es', profiles.es));
      }
      
      // Then add the "Add Profile" buttons after the profile cards
      if (!profiles.en) {
        const enButton = document.getElementById('add-english-profile').cloneNode(true);
        enButton.style.display = 'flex';
        enButton.onclick = function() {
          currentLang = 'en';
          localStorage.setItem('preferredLanguage', 'en');
          document.querySelectorAll('.lang-btn').forEach(btn => {
            btn.classList.remove('active');
            if (btn.textContent.includes('English')) btn.classList.add('active');
          });
          showForm('en', false);
        };
        container.appendChild(enButton);
      }
      
      if (!profiles.es) {
        const esButton = document.getElementById('add-spanish-profile').cloneNode(true);
        esButton.style.display = 'flex';
        esButton.onclick = function() {
          currentLang = 'es';
          localStorage.setItem('preferredLanguage', 'es');
          document.querySelectorAll('.lang-btn').forEach(btn => {
            btn.classList.remove('active');
            if (btn.textContent.includes('Español')) btn.classList.add('active');
          });
          showForm('es', false);
        };
        container.appendChild(esButton);
      }
      
      // Hide the original add buttons container
      addButtons.style.display = 'none';
      
      // Enable/disable submit button
      submitButton.disabled = !profiles.en && !profiles.es;
      if (!submitButton.disabled) {
        submitButton.classList.remove('btn-disabled');
      } else {
        submitButton.classList.add('btn-disabled');
      }
    }

    // Create profile card
    function createProfileCard(lang, data) {
      const card = document.createElement('div');
      card.className = 'profile-card';
      
      const trans = formTranslations[currentLang] || formTranslations.en;
      const langLabel = lang === 'en' ? 'English Profile' : 'Perfil en español';
      const langBadgeText = lang === 'en' ? 'English' : 'Español';
      const editLabel = trans['btn-edit'] || (currentLang === 'en' ? 'Edit' : 'Editar');
      const viewLabel = trans['btn-view'] || (currentLang === 'en' ? 'View' : 'Ver');
      const deleteLabel = trans['btn-delete'] || (currentLang === 'en' ? 'Delete' : 'Eliminar');
      
      // Get photo URL if file was uploaded
      const photoURL = data.photo_url || 'assets/images/placeholder-avatar.svg';
      const fullName = data.full_name || 'undefined';
      const preferredName = data.preferred_name || 'undefined';
      const course = data.course || 'undefined';
      const section = data.section || 'undefined';
      const pronouns = data.pronouns || 'undefined';
      
      card.innerHTML = `
        <div class="profile-card-header">
          <img src="${photoURL}" alt="${fullName}" class="profile-card-photo" onerror="this.src='assets/images/placeholder-avatar.svg'">
          <div class="profile-card-name">${fullName}</div>
          <div class="profile-card-preferred">${preferredName}</div>
        </div>
        <div class="profile-card-content">
          <div class="profile-card-badges">
            <span class="profile-badge badge-course">${course}</span>
            <span class="profile-badge badge-section">${section}</span>
          </div>
          <div class="profile-card-badges">
            <span class="profile-badge badge-language">${langBadgeText}</span>
          </div>
          <div class="profile-card-extra">${pronouns}</div>
        </div>
        <div class="profile-card-footer">
          <button class="btn btn-small btn-secondary" onclick="viewProfile('${lang}')">${viewLabel}</button>
          <button class="btn btn-small btn-primary" onclick="editProfile('${lang}')">${editLabel}</button>
          <button class="btn btn-small btn-danger" onclick="deleteProfile('${lang}')">${deleteLabel}</button>
        </div>
      `;
      
      return card;
    }

    // Show form for adding/editing profile
    function showForm(lang, isEditing = false, isViewOnly = false) {
      currentFormLanguage = lang;
      editingLanguage = isEditing ? lang : null;
      
      document.getElementById('profile-selection-view').style.display = 'none';
      document.getElementById('form-container').style.display = 'block';

      // Apply page language translation
      updateLanguage(lang);
      
      // Apply form translations for the selected language
      updateFormLanguage(lang);
      
      // Load existing data if editing or viewing
      if ((isEditing || isViewOnly) && profiles[lang]) {
        populateForm(profiles[lang]);
      } else {
        document.getElementById('profile-form').reset();
      }

      // Toggle submit button for view-only mode
      const submitButton = document.getElementById('add-profile-submit');
      if (submitButton) {
        submitButton.style.display = isViewOnly ? 'none' : 'inline-flex';
      }

      // Disable all fields in view-only mode
      document.querySelectorAll('#profile-form input, #profile-form textarea, #profile-form select').forEach(field => {
        if (field.id === 'final-privacy-consent') return;
        const isTeamField = field.id === 'team';
        field.disabled = isViewOnly || isTeamField;
      });
      
      // Scroll to top
      window.scrollTo(0, 0);
    }
    
    // Update form language-specific content
    function updateFormLanguage(lang) {
      const trans = formTranslations[lang] || formTranslations.en;
      
      // Update all form labels with data-i18n attribute
      document.querySelectorAll('label[data-i18n]').forEach(label => {
        const key = label.getAttribute('data-i18n');
        if (trans[key]) {
          const group = label.closest('.form-group');
          const isRequired = group?.querySelector('[required]');
          label.textContent = isRequired ? `${trans[key]} *` : trans[key];
        }
      });
      
      // Update form notes
      document.querySelectorAll('.form-note[data-i18n-note]').forEach(note => {
        const key = note.getAttribute('data-i18n-note');
        if (trans[key]) {
          note.textContent = trans[key];
        }
      });
      
      // Update placeholders
      document.querySelectorAll('[data-i18n-placeholder]').forEach(input => {
        const key = input.getAttribute('data-i18n-placeholder');
        if (trans[key]) {
          input.placeholder = trans[key];
        }
      });
      
      // Update section headers
      document.querySelectorAll('.section-header [data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        if (trans[key]) {
          el.textContent = trans[key];
        }
      });
      
      // Update subsection headers
      document.querySelectorAll('.subsection-header [data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        if (trans[key]) {
          el.textContent = trans[key];
        }
      });
      
      // Update alter ego description
      const alterDescription = document.querySelector('.form-description[data-i18n]');
      if (alterDescription) {
        const key = alterDescription.getAttribute('data-i18n');
        if (trans[key]) {
          alterDescription.textContent = trans[key];
        }
      }
      
      // Update privacy checkbox label
      const privacyLabel = document.querySelector('#final-privacy-consent + label[data-i18n]');
      if (privacyLabel) {
        const key = privacyLabel.getAttribute('data-i18n');
        if (trans[key]) {
          privacyLabel.textContent = trans[key];
        }
      }
      
      // Update submit button text
      const submitBtn = document.querySelector('#add-profile-submit [data-i18n]');
      if (submitBtn) {
        const key = submitBtn.getAttribute('data-i18n');
        if (trans[key]) {
          submitBtn.textContent = trans[key];
        }
      }
      
      // Update select options
      document.querySelectorAll('option[data-i18n]').forEach(option => {
        const key = option.getAttribute('data-i18n');
        if (trans[key]) {
          option.textContent = trans[key];
        }
      });
    }

    // Populate form with data
    function populateForm(data) {
      Object.keys(data).forEach(key => {
        const input = document.querySelector(`[name="${key}"]`);
        if (input && input.type !== 'file') {
          if (input.type === 'checkbox') {
            input.checked = data[key];
          } else {
            input.value = data[key];
          }
        }
      });
    }

    // Handle form submission
    document.getElementById('profile-form').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const formData = new FormData(this);
      const data = {};
      
      // Collect form data
      for (let [key, value] of formData.entries()) {
        if (value instanceof File && value.size > 0) {
          // Convert file to data URL for storage
          if (key === 'photo') {
            data.photo_url = await fileToDataURL(value);
          }
          // Store filename for other files
          data[key] = value.name;
        } else if (!(value instanceof File)) {
          data[key] = value;
        }
      }
      
      // Save profile
      profiles[currentFormLanguage] = data;
      saveProfiles();
      
      // Show success message
      const message = currentLang === 'en' 
        ? `${currentFormLanguage === 'en' ? 'English' : 'Spanish'} profile saved!`
        : `¡Perfil en ${currentFormLanguage === 'en' ? 'inglés' : 'español'} guardado!`;
      alert(message);
      
      // Return to selection view
      showProfileSelection();
    });

    // Helper function to convert file to data URL
    function fileToDataURL(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result);
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }

    // Back/Cancel button
    document.getElementById('back-button').addEventListener('click', function() {
        showProfileSelection();
    });

    // Add profile buttons
    document.getElementById('add-english-profile').addEventListener('click', function() {
      // Switch language without updating views (form will handle it)
      currentLang = 'en';
      localStorage.setItem('preferredLanguage', 'en');
      
      // Update button states
      document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.textContent.includes('English')) {
          btn.classList.add('active');
        }
      });
      
      showForm('en', false);
    });

    document.getElementById('add-spanish-profile').addEventListener('click', function() {
      // Switch language without updating views (form will handle it)
      currentLang = 'es';
      localStorage.setItem('preferredLanguage', 'es');
      
      // Update button states
      document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.textContent.includes('Español')) {
          btn.classList.add('active');
        }
      });
      
      showForm('es', false);
    });

    // Edit profile function
    window.editProfile = function(lang) {
      showForm(lang, true, false);
    };

    window.viewProfile = function(lang) {
      showForm(lang, true, true);
    };

    // Delete profile function
    window.deleteProfile = function(lang) {
      const langName = lang === 'en' ? 'English' : 'Spanish';
      const langNameEs = lang === 'en' ? 'inglés' : 'español';
      const prompt1 = currentLang === 'en' 
        ? `To delete your ${langName} profile, type "I Understand" below:`
        : `Para eliminar tu perfil en ${langNameEs}, escribe "I Understand" a continuación:`;
      
      const confirmation = window.prompt(prompt1);
      
      if (confirmation === 'I Understand') {
        profiles[lang] = null;
        saveProfiles();
        updateProfileSelectionView();
        
        const message = currentLang === 'en'
          ? `${langName} profile deleted.`
          : `Perfil en ${langNameEs} eliminado.`;
        alert(message);
      } else if (confirmation !== null) {
        alert(currentLang === 'en' ? 'Deletion cancelled.' : 'Eliminación cancelada.');
      }
    };

    // Submit all profiles
    document.getElementById('submit-all-profiles').addEventListener('click', async function() {
      if (!profiles.en && !profiles.es) return;
      
      try {
        // Mark profiles as submitted with timestamp
        const submittedData = {
          timestamp: new Date().toISOString(),
          submitted: true,
          profiles: {
            en: profiles.en || null,
            es: profiles.es || null
          }
        };
        
        // Save to submitted profiles list in localStorage
        const submittedProfiles = JSON.parse(localStorage.getItem('submittedProfiles') || '[]');
        submittedProfiles.push(submittedData);
        localStorage.setItem('submittedProfiles', JSON.stringify(submittedProfiles));
        
        // Clear current working profiles
        profiles = { en: null, es: null };
        saveProfiles();
        
        // Show success view
        showSuccessView();
        
      } catch (error) {
        console.error('Error submitting profiles:', error);
        const message = currentLang === 'en'
          ? 'An error occurred while submitting your profile. Please try again.'
          : 'Ocurrió un error al enviar tu perfil. Por favor, inténtalo de nuevo.';
        alert(message);
      }
    });

    // Show success confirmation view
    function showSuccessView() {
      document.getElementById('profile-selection-view').style.display = 'none';
      document.getElementById('form-container').style.display = 'none';
      document.getElementById('success-view').style.display = 'block';
      
      // Apply current language translations
      updateLanguage(currentLang);
    }

    // Home button - go back to main page
    document.getElementById('home-button').addEventListener('click', function() {
      window.location.href = 'index.html';
    });

    // Submit new profile button - reload the form
    document.getElementById('submit-new-profile-button').addEventListener('click', function() {
      document.getElementById('success-view').style.display = 'none';
      showProfileSelection();
    });

    // Collapsible sections functionality
    function initCollapsibleSections() {
      const sections = document.querySelectorAll('.form-section.collapsible');
      
      sections.forEach(section => {
        const header = section.querySelector('.section-header');
        
        if (header) {
          header.addEventListener('click', function(e) {
            section.classList.toggle('collapsed');
          });
        }
      });
    }

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', function() {
      loadProfiles();
      initCollapsibleSections();
      
      // Apply saved language preference
      if (currentLang !== 'en') {
        document.querySelectorAll('.lang-btn').forEach(btn => {
          btn.classList.remove('active');
          if (btn.textContent === (currentLang === 'es' ? 'Español' : 'English')) {
            btn.classList.add('active');
          }
        });
      }
      updateLanguage(currentLang);
      showProfileSelection();
    });
  </script>
</body>
</html>
